export UID=$(shell id -u)
export GID=$(shell id -g)

install: build-compose-file ${INSTALL_TARGET}

install-docker:
	docker-compose build
	docker-compose up -d
	docker-compose exec php-fpm composer install
	docker-compose exec php-fpm \
		/usr/local/bin/wait-for postgres:5432 -t 30 \
		-- ./bin/K migrate:setup

install-buoy: install-dev

install-dev: install-docker migrate

migrate:
	docker-compose exec php-fpm ./bin/K migrate

build-compose-file:
	rm -f docker-stack.yml docker-compose.yml
	docker-compose -f docker-utils.yml run --rm yaml-merge
